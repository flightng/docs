# 安全系统 (Failsafe)

Fydelix 内置完善的安全保护机制，确保飞行安全。

!!! info "强制启用"
    安全系统强制启用，无法关闭。

---

## 保护功能

| 功能 | 说明 |
|------|------|
| RC 信号丢失保护 | 检测遥控信号丢失并执行保护动作 |
| 电池电压监控 | 实时监控并在 OSD 显示警告 |
| 解锁条件检测 | 检查条件后才允许解锁 |

---

## RC 信号丢失保护

### 二阶段保护策略

| 阶段 | 触发条件 | 默认动作 |
|------|----------|----------|
| 阶段 1 | 检测到信号丢失 | 稳定飞行姿态 |
| 阶段 2 | 阶段 1 超时 | 安全停机 |

### 阶段 1

信号丢失后，飞控会：

- 将 Roll/Pitch/Yaw 设为中位
- 保持一定油门
- 维持稳定飞行姿态

**目的**：给 RC 信号恢复的机会

### 阶段 2

如果阶段 1 超时，飞控会：

- 停止所有电机
- 防止失控造成更大损害

---

## 参数配置

### RC 丢失参数

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `FS_RC_LOSS_STAGE_1_TIME` | 150 | 阶段 1 持续时间 (ms) |
| `FS_RC_STAGE1_ACTION` | 1 | 阶段 1 动作 |
| `FS_RC_STAGE2_ACTION` | 3 | 阶段 2 动作 |
| `FS_LAND_THROTTLE` | 0.3 | RC 丢失时油门值 |

### 动作类型

| 代码 | 动作 |
|------|------|
| 0 | 无动作 |
| 1 | 通道覆盖（稳定飞行） |
| 2 | 自动降落 |
| 3 | 停机 |

### 电池参数

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `FS_BAT_WARN_V` | 14.4 | 警告电压 (V) |
| `FS_BAT_CRIT_V` | 13.2 | 危险电压 (V) |

!!! note "说明"
    电池监控仅在 OSD 显示警告，不会触发停机。

---

## 解锁条件

解锁前系统会检查：

- [x] 传感器状态正常
- [x] 油门在最低位
- [x] RC 信号有效
- [x] 加速度计已校准

所有条件满足后才能解锁。

---

## 查看状态

```
failsafe status
```

显示当前安全系统状态。

---

## 测试

!!! danger "警告"
    测试前请卸下螺旋桨！

```
# 测试 RC 丢失响应
failsafe test rc

# 测试解锁条件
failsafe test arming

# 重置状态
failsafe reset
```

---

## 配置示例

### 竞速配置

更快的响应：

```
param set FS_RC_LOSS_STAGE_1_TIME 100
param save
```

### 长航时配置

给信号恢复更多时间：

```
param set FS_RC_LOSS_STAGE_1_TIME 500
param save
```

---

## 飞行前检查

1. 确认 Failsafe 状态正常
2. 测试 RC 丢失响应（关闭遥控器）
3. 验证信号恢复后能重新控制

